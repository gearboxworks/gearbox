
/******************************************************************************
*
*   FILE
*   ----
*   SwitchForLCEGenerator.c
*
*   History
*   -------
*   2017-03-29   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_Demo
#define OV_COMPILE_LIBRARY_Demo
#endif


#include "Demo.h"
#include "libov/ov_macros.h"
#include "openaas_helpers.h"

OV_DLLFNCEXPORT void Demo_SwitchForLCEGenerator_typemethod(
	OV_INSTPTR_fb_functionblock	pfb,
	OV_TIME						*pltc
) {
    /*    
    *   local variables
    */
    OV_INSTPTR_Demo_SwitchForLCEGenerator pinst = Ov_StaticPtrCast(Demo_SwitchForLCEGenerator, pfb);
    pinst->v_Error = 0;
	ov_string_setvalue(&pinst->v_AASIDStringOut, "");
	pinst->v_AASIDTypeOut = 0;
	IdentificationType aasId1;
	IdentificationType_init(&aasId1);
	ov_string_setvalue(&aasId1.IdSpec, pinst->v_AASIdString1);
	aasId1.IdType = pinst->v_AASIdType1;

	PropertyValueStatement pvs1;
	PropertyValueStatement_init(&pvs1);

	IdentificationType aasId2;
	IdentificationType_init(&aasId2);
	ov_string_setvalue(&aasId2.IdSpec, pinst->v_AASIdString2);
	aasId2.IdType = pinst->v_AASIdType2;

	PropertyValueStatement pvs2;
	PropertyValueStatement_init(&pvs2);



	OV_BOOL aasID1Plugged = FALSE;
	OV_BOOL aasID2Plugged = FALSE;

	ov_string_setvalue(&pvs1.ID.IdSpec, pinst->v_PVSID1);
	pvs1.ID.IdType = URI;
	pinst->v_Error |= openaas_modelmanager_getPVS(aasId1, pvs1.ID, &pvs1.PvsName, &pvs1.CarrierId, &pvs1.ExpressionLogic, &pvs1.ExpressionSemantic, &pvs1.PropertyId, &pvs1.View, &pvs1.Visibility, &pvs1.Value);
	if ((pvs1.Value.value.vartype & OV_VT_KSMASK) == OV_VT_BOOL){
		if (pvs1.Value.value.valueunion.val_bool == TRUE){
			aasID1Plugged = TRUE;
		}
	}
	ov_string_setvalue(&pvs2.ID.IdSpec, pinst->v_PVSID2);
	pvs2.ID.IdType = URI;
	pinst->v_Error |= openaas_modelmanager_getPVS(aasId2, pvs2.ID, &pvs2.PvsName, &pvs2.CarrierId, &pvs2.ExpressionLogic, &pvs2.ExpressionSemantic, &pvs2.PropertyId, &pvs2.View, &pvs2.Visibility, &pvs2.Value);
	if ((pvs2.Value.value.vartype & OV_VT_KSMASK) == OV_VT_BOOL){
		if (pvs2.Value.value.valueunion.val_bool == TRUE){
			aasID2Plugged = TRUE;
		}
	}

	if (aasID1Plugged && aasID2Plugged)
		pinst->v_Error |= 99;
	else{
		if (aasID1Plugged == TRUE){
			ov_string_setvalue(&pinst->v_AASIDStringOut, aasId1.IdSpec);
			pinst->v_AASIDTypeOut = aasId1.IdType;
		}else if (aasID2Plugged == TRUE){
			ov_string_setvalue(&pinst->v_AASIDStringOut, aasId2.IdSpec);
			pinst->v_AASIDTypeOut = aasId2.IdType;
		}
	}

	PropertyValueStatement_deleteMembers(&pvs1);
	PropertyValueStatement_deleteMembers(&pvs2);
	IdentificationType_deleteMembers(&aasId1);
	IdentificationType_deleteMembers(&aasId2);
    return;
}

