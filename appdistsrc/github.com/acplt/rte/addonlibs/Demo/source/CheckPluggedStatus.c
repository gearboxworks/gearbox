
/******************************************************************************
*
*   FILE
*   ----
*   CheckPluggedStatus.c
*
*   History
*   -------
*   2017-03-29   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_Demo
#define OV_COMPILE_LIBRARY_Demo
#endif


#include "Demo.h"
#include "libov/ov_macros.h"
#include "openaas_helpers.h"

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_AASIdString1_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_STRING  value
) {
    return ov_string_setvalue(&pobj->v_AASIdString1,value);
}

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_AASIdType1_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_UINT  value
) {
    pobj->v_AASIdType1 = value;
    return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_PVSID_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_STRING  value
) {
    return ov_string_setvalue(&pobj->v_PVSID,value);
}

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_AASIdString2_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_STRING  value
) {
    return ov_string_setvalue(&pobj->v_AASIdString2,value);
}

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_AASIdType2_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_UINT  value
) {
    pobj->v_AASIdType2 = value;
    return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_PVS2ID_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_STRING  value
) {
    return ov_string_setvalue(&pobj->v_PVS2ID,value);
}

OV_DLLFNCEXPORT OV_RESULT Demo_CheckPluggedStatus_Plugged_set(
    OV_INSTPTR_Demo_CheckPluggedStatus          pobj,
    const OV_BOOL  value
) {
    pobj->v_Plugged = value;
    return OV_ERR_OK;
}

OV_DLLFNCEXPORT void Demo_CheckPluggedStatus_typemethod(
	OV_INSTPTR_fb_functionblock	pfb,
	OV_TIME						*pltc
) {
    /*    
    *   local variables
    */
    OV_INSTPTR_Demo_CheckPluggedStatus pinst = Ov_StaticPtrCast(Demo_CheckPluggedStatus, pfb);

    pinst->v_Error = 0;
    ov_string_setvalue(&pinst->v_Status, "");
    IdentificationType aasId1;
	IdentificationType_init(&aasId1);
	ov_string_setvalue(&aasId1.IdSpec, pinst->v_AASIdString1);
	aasId1.IdType = pinst->v_AASIdType1;

    PropertyValueStatement pvs1;
	PropertyValueStatement_init(&pvs1);

	IdentificationType aasId2;
	IdentificationType_init(&aasId2);
	ov_string_setvalue(&aasId2.IdSpec, pinst->v_AASIdString2);
	aasId2.IdType = pinst->v_AASIdType2;

	PropertyValueStatement pvs2;
	PropertyValueStatement_init(&pvs2);

	ov_string_setvalue(&pvs1.ID.IdSpec, pinst->v_PVSID);
	pvs1.ID.IdType = URI;
	if (openaas_modelmanager_getPVS(aasId1, pvs1.ID, &pvs1.PvsName, &pvs1.CarrierId, &pvs1.ExpressionLogic, &pvs1.ExpressionSemantic, &pvs1.PropertyId, &pvs1.View, &pvs1.Visibility, &pvs1.Value) == 0){
		if ((pvs1.Value.value.vartype & OV_VT_KSMASK) == OV_VT_BOOL){
			if (pvs1.Value.value.valueunion.val_bool == pinst->v_Plugged){
				if (pinst->v_Plugged == TRUE)
					ov_string_setvalue(&pinst->v_Status, "AAS1 allready plugged");
				else
					ov_string_setvalue(&pinst->v_Status, "AAS1 allready deplugged");
			}
		}
	}else{
		ov_string_setvalue(&pinst->v_Status, "Problem while getting PVS Data");
	}
	ov_string_setvalue(&pvs2.ID.IdSpec, pinst->v_PVS2ID);
	pvs2.ID.IdType = URI;
	if (openaas_modelmanager_getPVS(aasId2, pvs2.ID, &pvs2.PvsName, &pvs2.CarrierId, &pvs2.ExpressionLogic, &pvs2.ExpressionSemantic, &pvs2.PropertyId, &pvs2.View, &pvs2.Visibility, &pvs2.Value) == 0){
		if ((pvs2.Value.value.vartype & OV_VT_KSMASK) == OV_VT_BOOL){
			if (pvs2.Value.value.valueunion.val_bool == pinst->v_Plugged){
				if (pinst->v_Plugged == TRUE)
					ov_string_setvalue(&pinst->v_Status, "AAS2 allready plugged");
				else
					ov_string_setvalue(&pinst->v_Status, "AAS2 allready deplugged");
			}
		}
	}else{
		ov_string_setvalue(&pinst->v_Status, "Problem while getting PVS Data");
	}

	PropertyValueStatement_deleteMembers(&pvs1);
	PropertyValueStatement_deleteMembers(&pvs2);
	IdentificationType_deleteMembers(&aasId1);
	IdentificationType_deleteMembers(&aasId2);

    return;
}

