
/******************************************************************************
*
*   FILE
*   ----
*   modelmanager.c
*
*   History
*   -------
*   2016-12-22   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_openaasOPCUAInterface
#define OV_COMPILE_LIBRARY_openaasOPCUAInterface
#endif

#include "openaasOPCUAInterface.h"
#include "libov/ov_macros.h"
#include "libov/ov_result.h"

OV_DLLFNCEXPORT AASStatusCode openaasOPCUAInterface_interface_startGetAssetLCEData(IdentificationType aasId, OV_STRING ipaddress, IdentificationType assetAASId) {
	OV_RESULT ovResult = OV_ERR_OK;
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaasOPCUAInterface_aasDI paasDi = NULL;
	OV_INSTPTR_fb_task	purtask = NULL;
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		paasDi = Ov_StaticPtrCast(openaasOPCUAInterface_aasDI, Ov_SearchChild(ov_containment, Ov_StaticPtrCast(ov_domain, paas), "AASDI"));
		if(!paasDi){
			ovResult = Ov_CreateObject(openaasOPCUAInterface_aasDI, paasDi, Ov_StaticPtrCast(ov_domain, paas), "AASDI");
			if(Ov_Fail(ovResult)){
				ov_logfile_error("Fatal: could not create AASDI object - reason: %s", ov_result_getresulttext(ovResult));
				return openaas_modelmanager_ovresultToAASStatusCode(ovResult);
			}
			purtask = (OV_INSTPTR_fb_task)ov_path_getobjectpointer("/Tasks/UrTask", 2);
			ovResult = Ov_Link(fb_tasklist, purtask, paasDi);
			if (Ov_Fail(ovResult)) {
				ov_logfile_error("Fatal: could not link object - reason: %s", ov_result_getresulttext(ovResult));
				return openaas_modelmanager_ovresultToAASStatusCode(ovResult);
			}
		}
		ov_string_setvalue(&(paasDi->v_AASIdString), aasId.IdSpec);
		paasDi->v_AASIdType = aasId.IdType;
		ov_string_setvalue(&(paasDi->v_AssetAASIdString), assetAASId.IdSpec);
		paasDi->v_AssetAASIdType = assetAASId.IdType;
		ov_string_setvalue(&(paasDi->v_AssetIPAddress), ipaddress);

		openaasOPCUAInterface_aasDI_StartAASDI_set(paasDi, TRUE);
	}else{
		return AASSTATUSCODE_BADUNEXPECTEDERROR;
	}
	return AASSTATUSCODE_GOOD;
}

OV_DLLFNCEXPORT AASStatusCode openaasOPCUAInterface_interface_stopGetAssetLCEData(IdentificationType aasId) {
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaasOPCUAInterface_aasDI paasDi = NULL;
	ptr = ov_path_getobjectpointer(openaas_modelmanager_AASConvertListGet(aasId), 2);
	if (!ptr)
		return AASSTATUSCODE_BADAASID;
	paas = Ov_StaticPtrCast(openaas_aas, ptr);
	if (paas){
		paasDi = Ov_StaticPtrCast(openaasOPCUAInterface_aasDI, Ov_SearchChild(ov_containment, Ov_StaticPtrCast(ov_domain, paas), "AASDI"));
		if(paasDi){
			openaasOPCUAInterface_aasDI_StartAASDI_set(paasDi, FALSE);
			openaasOPCUAInterface_aasDI_StopAASDI_set(paasDi, TRUE);
		}
	}
	return AASSTATUSCODE_GOOD;
}
