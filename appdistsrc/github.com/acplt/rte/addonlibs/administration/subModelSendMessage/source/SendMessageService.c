
/******************************************************************************
*
*   FILE
*   ----
*   SendMessageService.c
*
*   History
*   -------
*   2018-01-19   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_subModelSendMessage
#define OV_COMPILE_LIBRARY_subModelSendMessage
#endif


#include "subModelSendMessage.h"
#include "libov/ov_macros.h"


OV_DLLFNCEXPORT OV_RESULT subModelSendMessage_SendMessageService_CallMethod(      
  OV_INSTPTR_services_Service pobj,       
  OV_UINT numberofInputArgs,       
  const void **packedInputArgList,       
  OV_UINT numberofOutputArgs,      
  void **packedOutputArgList,
  OV_UINT *typeArray       
) {
    /*    
    *   local variables
    */
	OV_STRING status = NULL;

	packedOutputArgList[0] = ov_database_malloc(sizeof(OV_STRING));
	*(OV_STRING*)packedOutputArgList[0] = NULL;
	typeArray[0] = OV_VT_STRING;


	if(ov_string_compare(*(OV_STRING*)(packedInputArgList[0]), "") == OV_STRCMP_EQUAL){
		ov_string_setvalue(&status, "Input Variables not set");
		goto FINALIZE;
	}

	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_openaas_aas paas = NULL;
	OV_INSTPTR_ov_object ptr2 = NULL;


	ptr = Ov_StaticPtrCast(ov_object, Ov_GetParent(ov_containment, pobj));
	if (!ptr){
		ptr = pobj->v_pouterobject;
	}
	do{
		if (Ov_CanCastTo(openaas_aas, ptr)){
			paas = Ov_StaticPtrCast(openaas_aas, ptr);
			break;
		}
		ptr2 = Ov_StaticPtrCast(ov_object, Ov_GetParent(ov_containment, ptr));
		if (!ptr2){
			ptr2 = ptr->v_pouterobject;
		}
		ptr = ptr2;
	}while (ptr);

	if (!paas){
		ov_string_setvalue(&status, "Could not find AAS");
		goto FINALIZE;
	}

	OV_INSTPTR_MessageSys_Message pMessage = NULL;
	OV_INSTPTR_openaas_AASComponentManager pComponentManager = &paas->p_ComponentManager;
	OV_RESULT result = Ov_CreateObject(MessageSys_Message, pMessage, &pComponentManager->p_INBOX, "message");
	if(Ov_Fail(result)) {
		ov_string_setvalue(&status, "Could not create a Message object");
		goto FINALIZE;
	}
	OV_INSTPTR_MessageSys_Message msg = Ov_StaticPtrCast(MessageSys_Message,pMessage);
	ov_string_setvalue(&msg->v_msgBody,"<bdy>");
	ov_string_append(&msg->v_msgBody,*(OV_STRING*)(packedInputArgList[0]));
	ov_string_append(&msg->v_msgBody,"</bdy>");


	ov_string_setvalue(&msg->v_senderAddress,"127.0.0.1");
	ov_string_setvalue(&msg->v_receiverAddress,"127.0.0.1");
	ov_string_setvalue(&msg->v_senderName,"MANAGER");
	ov_string_setvalue(&msg->v_receiverName,"MANAGER");
	ov_string_setvalue(&msg->v_senderComponent,"me");
	ov_string_setvalue(&msg->v_receiverComponent,"");
	msg->v_msgStatus = 0;

	ov_string_setvalue(&msg->v_msgID,"15467");
	ov_string_setvalue(&msg->v_auth,"");

	msg->v_expectAnswer = false;
	ov_string_setvalue(&status, "Message sending was sucessful");

	FINALIZE:
	*(OV_STRING*)packedOutputArgList[0] = ov_database_malloc(ov_string_getlength(status)+1);
	ov_string_setvalue((OV_STRING*)packedOutputArgList[0],status);
	ov_string_setvalue(&status,NULL);
	return OV_ERR_OK;
}

