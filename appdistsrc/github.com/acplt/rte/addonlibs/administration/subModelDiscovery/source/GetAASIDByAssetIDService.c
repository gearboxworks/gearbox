
/******************************************************************************
*
*   FILE
*   ----
*   GetAASIDfromAssetIDService.c
*
*   History
*   -------
*   2018-01-17   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_subModelDiscovery
#define OV_COMPILE_LIBRARY_subModelDiscovery
#endif


#include "subModelDiscovery.h"
#include "libov/ov_macros.h"


OV_DLLFNCEXPORT OV_RESULT subModelDiscovery_GetAASIDByAssetIDService_CallMethod(
  OV_INSTPTR_services_Service pobj,       
  OV_UINT numberofInputArgs,       
  const void **packedInputArgList,       
  OV_UINT numberofOutputArgs,      
  void **packedOutputArgList,
  OV_UINT *typeArray       
) {
    /*    
    *   local variables
    */

	OV_STRING status = NULL;

	packedOutputArgList[0] = ov_database_malloc(sizeof(OV_STRING));
	*(OV_STRING*)packedOutputArgList[0] = NULL;
	typeArray[0] = OV_VT_STRING;

	packedOutputArgList[1] = ov_database_malloc(sizeof(OV_UINT));
	*(OV_UINT*)packedOutputArgList[1] = 0;
	typeArray[1] = OV_VT_UINT;

	packedOutputArgList[2] = ov_database_malloc(sizeof(OV_STRING));
	*(OV_STRING*)packedOutputArgList[2] = NULL;
	typeArray[2] = OV_VT_STRING;


	OV_STRING tmpHexStringAsset = NULL;
	OV_STRING tmpHexString = NULL;
	ov_string_print(&tmpHexString, "%i", *(OV_UINT*)packedInputArgList[0]);
	ov_string_print(&tmpHexStringAsset, "%x", tmpHexString[0]);
	ov_string_setvalue(&tmpHexString, NULL);

	for (OV_UINT i = 0; i < ov_string_getlength(*(OV_STRING*)(packedInputArgList[1])); i++){
		ov_string_print(&tmpHexString, "%x", (*(OV_STRING*)(packedInputArgList[1]))[i]);
		ov_string_append(&tmpHexStringAsset, tmpHexString);
		ov_string_setvalue(&tmpHexString, NULL);
	}

	OV_INSTPTR_openAASDiscoveryServer_OVDataForAssetID pOvDataForAsset = NULL;
	OV_INSTPTR_openAASDiscoveryServer_DiscoveryServer pDiscoveryServer = NULL;
	OV_INSTPTR_subModelDiscovery_SubModelDiscovery pSubModel = NULL;
	pSubModel = Ov_StaticPtrCast(subModelDiscovery_SubModelDiscovery, pobj->v_pouterobject);
	pDiscoveryServer = &pSubModel->p_DiscoveryServer;

	pOvDataForAsset = Ov_StaticPtrCast(openAASDiscoveryServer_OVDataForAssetID, Ov_SearchChild(ov_containment, Ov_StaticPtrCast(ov_domain, &pDiscoveryServer->p_AssetIDs), tmpHexStringAsset));
	if(pOvDataForAsset){
		ov_string_setvalue(&status, "AssetID found");
		ov_string_setvalue((OV_STRING*)packedOutputArgList[0],status);
		*(OV_UINT*)packedOutputArgList[1] = pOvDataForAsset->v_AASIDType;
		ov_string_setvalue((OV_STRING*)packedOutputArgList[2],pOvDataForAsset->v_AASIDString);
	}else{
		ov_string_setvalue(&status, "AssetID not found");
	}
	ov_string_setvalue(&tmpHexStringAsset, NULL);
	ov_string_setvalue(&tmpHexString, NULL);
	ov_string_setvalue((OV_STRING*)packedOutputArgList[0],status);
	ov_string_setvalue(&status,NULL);
    return OV_ERR_OK;
}

