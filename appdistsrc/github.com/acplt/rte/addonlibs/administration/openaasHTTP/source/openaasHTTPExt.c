
/******************************************************************************
*
*   FILE
*   ----
*   openaasHTTPExt.c
*
*   History
*   -------
*   2018-09-10   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_openaasHTTP
#define OV_COMPILE_LIBRARY_openaasHTTP
#endif


#include "openaasHTTP.h"
#include "libov/ov_macros.h"
#include "ks_logfile.h"
#include "libov/ov_result.h"
#include "libov/ov_path.h"
#include "openaas_helpers.h"


OV_STRING convertExpressionLogicToString(ExpressionLogicEnum expressionLogic){
	OV_STRING tmpString = NULL;
	switch(expressionLogic){
		case 0:
			ov_string_setvalue(&tmpString, "Greater Than");
			break;
		case 1:
			ov_string_setvalue(&tmpString, "Greater Equal");
			break;
		case 2:
			ov_string_setvalue(&tmpString, "Equal");
			break;
		case 3:
			ov_string_setvalue(&tmpString, "Not Equal");
			break;
		case 4:
			ov_string_setvalue(&tmpString, "LESS EQUAL");
			break;
		case 5:
			ov_string_setvalue(&tmpString, "LESS THAN");
			break;
		default:
			break;
	}
	return tmpString;
}

OV_STRING convertExpressionSemanticToString(ExpressionSemanticEnum expressionSemantic){
	OV_STRING tmpString = NULL;
	switch(expressionSemantic){
		case 0:
			ov_string_setvalue(&tmpString, "Assurance");
			break;
		case 1:
			ov_string_setvalue(&tmpString, "Setting");
			break;
		case 2:
			ov_string_setvalue(&tmpString, "Requirement");
			break;
		case 3:
			ov_string_setvalue(&tmpString, "Measurement");
			break;
		default:
			break;
	}
	return tmpString;
}

OV_STRING convertValueToString(OV_ANY value){
	OV_STRING tmpString = NULL;
	OV_STRING tmpString2 = NULL;
	ov_string_setvalue(&tmpString2, "{\"value\":\"");
	switch(value.value.vartype & OV_VT_KSMASK){
		case OV_VT_BOOL:
			if (value.value.valueunion.val_bool == TRUE)
				ov_string_append(&tmpString2, "TRUE");
			else
				ov_string_append(&tmpString2, "FALSE");
		break;
		case OV_VT_STRING:
			ov_string_append(&tmpString2, value.value.valueunion.val_string);
		break;
		case OV_VT_DOUBLE:
			ov_string_print(&tmpString, "%lf", value.value.valueunion.val_double);
			ov_string_append(&tmpString2, tmpString);
		break;
		case OV_VT_INT:
			ov_string_print(&tmpString, "%i", value.value.valueunion.val_int);
			ov_string_append(&tmpString2, tmpString);
		break;
		case OV_VT_UINT:
			ov_string_print(&tmpString, "%u", value.value.valueunion.val_uint);
			ov_string_append(&tmpString2, tmpString);
		break;
		case OV_VT_SINGLE:
			ov_string_print(&tmpString, "%f", value.value.valueunion.val_single);
			ov_string_append(&tmpString2, tmpString);
		break;
		default:
			ov_string_setvalue(&tmpString2, NULL);
			return NULL;
		break;
	}
	ov_string_setvalue(&tmpString, ov_time_timetoascii_local(&value.time));
	ov_string_append(&tmpString2, "\",\"timeStamp\":\"");
	ov_string_append(&tmpString2, tmpString);
	ov_string_append(&tmpString2, "\"}");
	ov_string_setvalue(&tmpString, NULL);
	return tmpString2;
}




OV_BOOL checkIfParrent(OV_INSTPTR_ov_object pparent, OV_INSTPTR_ov_object pchild){
	OV_INSTPTR_ov_object ptr = NULL;
	OV_INSTPTR_ov_object ptr2 = NULL;

	ptr = Ov_StaticPtrCast(ov_object, Ov_GetParent(ov_containment, pchild));
	if (!ptr){
		ptr = pchild->v_pouterobject;
	}
	do{
		if (ptr == pparent){
			return TRUE;
		}
		ptr2 = Ov_StaticPtrCast(ov_object, Ov_GetParent(ov_containment, ptr));
		if (!ptr2){
			ptr2 = ptr->v_pouterobject;
		}
		ptr = ptr2;
	}while (ptr);
	return FALSE;
}


OV_RESULT getAAS(OV_INSTPTR_openaas_aas *pAAS, OV_STRING url, OV_STRING **pList, OV_UINT *len, OV_UINT *count){
	OV_STRING ressourcePath = NULL;
	*pList = ov_string_split(url, "/", len);
	for (*count = 0; *count < *len; (*count)++){
		if (*count == 0){
			ov_string_setvalue(&ressourcePath, (*pList)[*count]);
			continue;
		}
		if (ov_string_compare((*pList)[*count], "aas") == OV_STRCMP_EQUAL){
			break;
		}
		ov_string_append(&ressourcePath, "/");
		ov_string_append(&ressourcePath, (*pList)[*count]);
		if (count == len-1){ // Error
			KS_logfile_info(("could not find /aas"));
			ov_string_setvalue(&ressourcePath, NULL);
			ov_string_freelist(*pList);
			return OV_ERR_BADPARAM;
		}
	}

	*pAAS = Ov_DynamicPtrCast(openaas_aas, ov_path_getobjectpointer(ressourcePath, 2));
	ov_string_setvalue(&ressourcePath, NULL);
	if (!*pAAS){
		KS_logfile_info(("could not find aas object"));
		ov_string_freelist(*pList);
		return OV_ERR_BADPARAM;
	}

	return OV_ERR_OK;
}

OV_RESULT getSubModel(OV_INSTPTR_openaas_aas pAAS, OV_INSTPTR_openaas_SubModel *pSubModel, OV_STRING *pList, OV_UINT len, OV_UINT *count){
	OV_STRING ressourcePath = NULL;
	for (OV_UINT i = *count; i < len; i++){
		if (i == *count){
			ov_string_setvalue(&ressourcePath, pList[i]);
			continue;
		}
		if (ov_string_compare(pList[i], "properties") == OV_STRCMP_EQUAL || ov_string_compare(pList[i], "operations") == OV_STRCMP_EQUAL || ov_string_compare(pList[i], "events") == OV_STRCMP_EQUAL){
			*count = i-1;
			break;
		}
		ov_string_append(&ressourcePath, "/");
		ov_string_append(&ressourcePath, pList[i]);
		if (i == len-1){
			*count = i;
		}
	}

	*pSubModel = Ov_DynamicPtrCast(openaas_SubModel, ov_path_getobjectpointer(ressourcePath, 2));
	ov_string_setvalue(&ressourcePath, NULL);
	if (!*pSubModel){
		KS_logfile_info(("could not find subModel object"));
		return OV_ERR_BADPARAM;
	}
	if (!checkIfParrent(Ov_DynamicPtrCast(ov_object, pAAS), Ov_DynamicPtrCast(ov_object, *pSubModel))){
		*pSubModel = NULL;
		KS_logfile_info(("submodel is not part of aas"));
		return OV_ERR_BADPARAM;
	}

	return OV_ERR_OK;
}

OV_RESULT getStatement(OV_INSTPTR_openaas_SubModel pSubModel, OV_INSTPTR_propertyValueStatement_PropertyValueStatement *pStatement, OV_STRING *pList, OV_UINT len, OV_UINT *count){
	OV_STRING ressourcePath = NULL;
	for (OV_UINT i = *count; i < len; i++){
		if (i == *count){
			ov_string_setvalue(&ressourcePath, pList[i]);
			continue;
		}
		ov_string_append(&ressourcePath, "/");
		ov_string_append(&ressourcePath, pList[i]);
		if (i == len-1){
			*count = i;
		}
	}

	*pStatement = Ov_DynamicPtrCast(propertyValueStatement_PropertyValueStatement, ov_path_getobjectpointer(ressourcePath, 2));
	ov_string_setvalue(&ressourcePath, NULL);
	if (!*pStatement){
		KS_logfile_info(("could not find property value statement object"));
		return OV_ERR_BADPARAM;
	}
	if (!checkIfParrent(Ov_DynamicPtrCast(ov_object, pSubModel), Ov_DynamicPtrCast(ov_object, *pStatement))){
		*pStatement = NULL;
		KS_logfile_info(("statement is not part of submodel"));
		return OV_ERR_BADPARAM;
	}

	return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_RESULT openaasHTTP_openaasHTTPExt_constructor(
	OV_INSTPTR_ov_object 	pobj
) {
    /*
    *   local variables
    */
    OV_RESULT    result;
    /* do what the base class does first */
    result = ov_object_constructor(pobj);
    if(Ov_Fail(result))
         return result;

    /* do what */
    return OV_ERR_OK;
}


OV_DLLFNCEXPORT OV_BOOL openaasHTTP_openaasHTTPExt_CheckCommand(
	const OV_INSTPTR_kshttp_httpClientHandlerExtension	pobj,
	const OV_INSTPTR_kshttp_httpclienthandler	pClientHandler,
	const OV_INSTPTR_ksbase_Channel pChannel,
	const HTTP_REQUEST request
) {
    /*
    *   local variables
    */
	OV_UINT len = 0;
	OV_STRING* pList = NULL;
	OV_UINT count = 0;
	OV_UINT kindOfQuery = 0; // 0:/aas; 1:/ass/submodels; 2:/ass/submodels/{subModelId}; 3:/ass/submodels/{subModelId}/properties;
							 // 4:/ass/submodels/{subModelId}/operations; 5:/ass/submodels/{subModelId}/events; 6:/ass/submodels/{subModelId}/properties/{propertyId}
							 // 7:/ass/submodels/{subModelId}/operations/{operationId}, 8:/ass/submodels/{subModelId}/events/{eventId}, 9:/aas/discovery

	OV_INSTPTR_openaasHTTP_openaasHTTPExt pExt = NULL;
	pExt = Ov_StaticPtrCast(openaasHTTP_openaasHTTPExt, pobj);
	pExt->v_pAAS = NULL;
	pExt->v_pSubModel = NULL;
	pExt->v_pStatement = NULL;
	pExt->v_pInterfaceDiscoveryServer = NULL;
	pExt->v_queryType = 0;

	// check if InterfaceDiscoverServer exist
	pExt->v_pInterfaceDiscoveryServer = Ov_StaticPtrCast(openaas_InterfaceDiscoveryServer, Ov_GetFirstChild(ov_instantiation, pclass_openaas_InterfaceDiscoveryServer));
	if(!pExt->v_pInterfaceDiscoveryServer){
		return FALSE;
	}

	// get AAS
	if (getAAS(&pExt->v_pAAS, request.urlPath, &pList, &len, &count) != OV_ERR_OK){
		return FALSE;
	}
	count++;
	if (count < len && ov_string_compare(pList[count], "submodels") == OV_STRCMP_EQUAL){
		kindOfQuery = 1;
	}else if (count < len && ov_string_compare(pList[count], "discovery") == OV_STRCMP_EQUAL){
		kindOfQuery = 9;
	}else if (count < len){
		return FALSE;
	}
	count++;
	// check if submodel is needed
	if (count < len){
		if (getSubModel(pExt->v_pAAS, &pExt->v_pSubModel, pList, len, &count) != OV_ERR_OK){
			ov_string_freelist(pList);
			return FALSE;
		}
		kindOfQuery = 2;
	}
	count++;
	if (count < len){
		if (ov_string_compare(pList[count], "properties") == OV_STRCMP_EQUAL){
			kindOfQuery = 3;
		}else if (ov_string_compare(pList[count], "operations") == OV_STRCMP_EQUAL){
			kindOfQuery = 4;
		}else if (ov_string_compare(pList[count], "events") == OV_STRCMP_EQUAL){
			kindOfQuery = 5;
		}else{
			return FALSE;
		}
	}
	count++;
	// check if property, operation or event is needed
	if (count < len){
		if (kindOfQuery == 3){
			// get Property
			if (getStatement(pExt->v_pSubModel, &pExt->v_pStatement, pList, len, &count) != OV_ERR_OK){
				ov_string_freelist(pList);
				return FALSE;
			}
			kindOfQuery = 6;
		}else if (kindOfQuery == 4){
			kindOfQuery = 7;
		}else if (kindOfQuery == 5){
			kindOfQuery = 8;
		}else{
			ov_string_freelist(pList);
			return FALSE;
		}
	}
	ov_string_freelist(pList);
	pExt->v_queryType = kindOfQuery;
    return TRUE;;
}

OV_DLLFNCEXPORT OV_RESULT openaasHTTP_openaasHTTPExt_HandleExtendedRequest(
	const OV_INSTPTR_kshttp_httpClientHandlerExtension	pobj,
	const OV_INSTPTR_kshttp_httpclienthandler	pClientHandler,
	const OV_INSTPTR_ksbase_Channel	pChannel,
	const HTTP_REQUEST request,
	HTTP_RESPONSE *response
) {
	OV_INSTPTR_openaasHTTP_openaasHTTPExt pExt = NULL;
	pExt = Ov_StaticPtrCast(openaasHTTP_openaasHTTPExt, pobj);
	ov_string_setvalue(&response->contentType, "application/json; charset=utf-8");
	if(ov_string_compare(request.requestMethod, "GET") == OV_STRCMP_EQUAL){
		switch (pExt->v_queryType){
			case 0:// /aas
				{
				// meta data from aas => aasID, assetID
				OV_STRING SenderEndpoint1 = NULL;
				OV_STRING SenderEndpoint2 = NULL;
				ov_string_setvalue(&SenderEndpoint1, pExt->v_pInterfaceDiscoveryServer->v_IPAddressServer);
				OV_STRING servername = NULL;
				OV_ANY srvnameprops;
				ov_vendortree_getservername(&srvnameprops, NULL);
				ov_string_setvalue(&servername,srvnameprops.value.valueunion.val_string);
				ov_string_append(&SenderEndpoint1, ":");
				ov_string_append(&SenderEndpoint1, servername);
				ov_string_setvalue(&servername, NULL);
				ov_memstack_lock();
				ov_string_append(&SenderEndpoint1, ":");
				ov_string_append(&SenderEndpoint1, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object,pExt->v_pAAS), 2));
				ov_memstack_unlock();
				ov_string_setvalue(&SenderEndpoint2, SenderEndpoint1);
				ov_string_append(&SenderEndpoint2, "/aas");
				ov_string_print(&response->contentString, "{\"AASID\":{\"IDType\":\"URI\", \"IDSpec\":\"%s\"}, \"AssetID\":{\"IDType\":\"URI\", \"IDSpec\":\"%s\"}, \"Endpoints\":[{\"protocolType\":\"acplt_ks\",\"endpointSring\":\"%s\"},{\"protocolType\":\"http\",\"endpointSring\":\"%s\"}]}", pExt->v_pAAS->p_AASID.v_IdSpec, pExt->v_pAAS->p_AssetID.v_IdSpec, SenderEndpoint1, SenderEndpoint2);
				ov_string_setvalue(&SenderEndpoint1, NULL);
				ov_string_setvalue(&SenderEndpoint2, NULL);

				return OV_ERR_OK;
				}
			case 1:// /aas/submodels
				{
				// list of submodels and their IDs
				OV_STRING tmpString = NULL;
				OV_BOOL first = TRUE;
				ov_string_setvalue(&response->contentString, "{\"submodels\":[");

				Ov_ForEachChildEx(ov_containment, &pExt->v_pAAS->p_Header, pExt->v_pSubModel, openaas_SubModel){
					if (first == FALSE){
						ov_string_append(&response->contentString, ",");
					}
					tmpString = NULL;
					ov_memstack_lock();
					ov_string_print(&tmpString, "{\"Name\":\"%s\", \"ID\":\"%s\"}", pExt->v_pSubModel->v_identifier, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object,pExt->v_pSubModel), 2));
					ov_memstack_unlock();
					ov_string_append(&response->contentString, tmpString);
					ov_string_setvalue(&tmpString, NULL);
					first = FALSE;
				}
				Ov_ForEachChildEx(ov_containment, &pExt->v_pAAS->p_Body, pExt->v_pSubModel, openaas_SubModel){
					if (first == FALSE){
						ov_string_append(&response->contentString, ",");
					}
					tmpString = NULL;
					ov_memstack_lock();
					ov_string_print(&tmpString, "{\"Name\":\"%s\", \"ID\":\"%s\"}", pExt->v_pSubModel->v_identifier, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object,pExt->v_pSubModel), 2));
					ov_memstack_unlock();
					ov_string_append(&response->contentString, tmpString);
					ov_string_setvalue(&tmpString, NULL);
					first = FALSE;
				}
				ov_string_append(&response->contentString, "]}");
				return OV_ERR_OK;
				}
			case 2: // /aas/submodels/{submodelId}
				{
				// list of properties and their IDs
				OV_INSTPTR_propertyValueStatement_PropertyValueStatementList pPVSList = NULL;
				OV_STRING tmpString = NULL;
				OV_BOOL first = TRUE;
				ov_string_setvalue(&response->contentString, "{\"properties\":[");

				Ov_ForEachChildEx(ov_containment, pExt->v_pSubModel, pPVSList, propertyValueStatement_PropertyValueStatementList){
					Ov_ForEachChildEx(ov_containment, pPVSList, pExt->v_pStatement, propertyValueStatement_PropertyValueStatement){
						if (first == FALSE){
							ov_string_append(&response->contentString, ",");
						}
						tmpString = NULL;
						ov_memstack_lock();
						ov_string_print(&tmpString, "{\"Name\":\"%s\", \"ID\":\"%s\"}", pExt->v_pStatement->v_identifier, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object,pExt->v_pStatement), 2));
						ov_memstack_unlock();
						ov_string_append(&response->contentString, tmpString);
						ov_string_setvalue(&tmpString, NULL);
						first = FALSE;
					}
				}
				ov_string_append(&response->contentString, "]");

				// list of operations and their IDs
				ov_string_append(&response->contentString, ",\"operations\":[");
				// TODO: Iterate over all operations
				ov_string_append(&response->contentString, "]");

				// list of events and their IDs
				ov_string_append(&response->contentString, ",\"events\":[");
				// TODO: Iterate over all events
				ov_string_append(&response->contentString, "]");

				ov_string_append(&response->contentString, "}");
				return OV_ERR_OK;
				}
			case 3:// /aas/submodels/{submodelId}/properties
				{
				// list of properties and their IDs
				OV_INSTPTR_propertyValueStatement_PropertyValueStatementList pPVSList = NULL;
				OV_STRING tmpString = NULL;
				OV_BOOL first = TRUE;
				ov_string_setvalue(&response->contentString, "{\"properties\":[");

				Ov_ForEachChildEx(ov_containment, pExt->v_pSubModel, pPVSList, propertyValueStatement_PropertyValueStatementList){
					Ov_ForEachChildEx(ov_containment, pPVSList, pExt->v_pStatement, propertyValueStatement_PropertyValueStatement){
						if (first == FALSE){
							ov_string_append(&response->contentString, ",");
						}
						tmpString = NULL;
						ov_memstack_lock();
						ov_string_print(&tmpString, "{\"Name\":\"%s\", \"ID\":\"%s\"}", pExt->v_pStatement->v_identifier, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object,pExt->v_pStatement), 2));
						ov_memstack_unlock();
						ov_string_append(&response->contentString, tmpString);
						ov_string_setvalue(&tmpString, NULL);
						first = FALSE;
					}
				}
				ov_string_append(&response->contentString, "]}");
				return OV_ERR_OK;
				}
			case 4:// /aas/submodels/{submodelId}/operations
				// list of operations and their IDs
				ov_string_setvalue(&response->contentString, "{\"operations\":[");
				// TODO: Iterate over all operations
				ov_string_append(&response->contentString, "]}");
				return OV_ERR_OK;
			case 5:// /aas/submodels/{submodelId}/events
				// list of events
				ov_string_setvalue(&response->contentString, "{\"events\":[");
				// TODO: Iterate over all operations
				ov_string_append(&response->contentString, "]}");
				return OV_ERR_OK;
			case 6:// /aas/submodels/{submodelId}/properties/{propertyId}
				{
				// value of propertyId
				IdentificationType pvsId;
				IdentificationType_init(&pvsId);
				OV_STRING pvsName = NULL;
				IdentificationType carrier;
				IdentificationType_init(&carrier);
				ExpressionLogicEnum expressionLogic;
				ExpressionSemanticEnum expressionSemantic;
				IdentificationType propertyId;
				IdentificationType_init(&propertyId);
				ViewEnum view;
				VisibilityEnum visibility;
				OV_ANY value = OV_ANY_INIT;

				pvsId.IdType = 0;
				ov_memstack_lock();
				ov_string_setvalue(&pvsId.IdSpec, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pExt->v_pStatement), 2));
				ov_memstack_unlock();

				if(propertyValueStatement_modelmanager_getPVS(pvsId, &pvsName, &carrier, &expressionLogic, &expressionSemantic, &propertyId, &view, &visibility, &value) == 0){

					ov_string_print(&response->contentString, "{\"property\":{\"Name\":\"%s\", \"CarrierID\":{\"IdType\":\"%s\", \"IDSpec\":\"%s\"}, \"ExpressionLogic\":\"%s\", \"ExpressionSemantic\":\"%s\", \"PropertyId\":{\"IdType\":\"%s\", \"IDSpec\":\"%s\"}, \"Value\":%s}}", pvsName, carrier.IdType == 0 ? "URI" : "ISO", carrier.IdSpec, convertExpressionLogicToString(expressionLogic), convertExpressionSemanticToString(expressionSemantic), propertyId.IdType == 0 ? "URI" : "ISO", propertyId.IdSpec, convertValueToString(value));
				}else{
					ov_string_setvalue(&response->contentString, "Internal Error");
				}
				IdentificationType_deleteMembers(&pvsId);
				IdentificationType_deleteMembers(&carrier);
				IdentificationType_deleteMembers(&propertyId);
				ov_string_setvalue(&pvsName, NULL);
				Ov_SetAnyValueByPointer(&value, OV_VT_VOID, NULL);
				return OV_ERR_OK;
				}
			case 7:// /aas/submodels/{submodelId}/operations/{operationId}
				// value of operationId
				ov_string_setvalue(&response->contentString, "Not implemented");
				return OV_ERR_OK;
			case 8:// /aas/submodels/{submodelId}/events/{eventId}
				// value of eventId
				ov_string_setvalue(&response->contentString, "Not implemented");
				return OV_ERR_OK;
			case 9:// /aas/discovery
				{
				OV_STRING tmpString = NULL;
				tmpString = getStatementsInJSON(pExt->v_pAAS);
				ov_string_setvalue(&response->contentString, "{");
				ov_string_append(&response->contentString, tmpString);
				ov_string_append(&response->contentString, "}");
				ov_string_setvalue(&tmpString, NULL);
				return OV_ERR_OK;
				}
			default:
				KS_logfile_info(("ressource is not implemented"));
				ov_string_setvalue(&response->contentString, HTTP_404_BODY);
				ov_string_setvalue(&response->contentType, "text/plain;");
				return OV_ERR_OK;
				break;
		}

	}else if(ov_string_compare(request.requestMethod, "POST") == OV_STRCMP_EQUAL){
		if(request.urlQuery.veclen == 0){
			KS_logfile_info(("no data in content", request.requestMethod));
			ov_string_setvalue(&response->contentString, "no data\n");
			ov_string_setvalue(&response->contentType, "text/plain;");
			return OV_ERR_BADVALUE;
		}
		switch (pExt->v_queryType){
			case 1:// /aas/submodels
				// add new Submodel
			case 3:// /aas/submodels/{submodelId}/properties
				// add new property
			case 4:// /aas/submodels/{submodelId}/operations
				// add new operation
			case 5:// /aas/submodels/{submodelId}/events
				// add new event
			case 7:// /aas/submodels/{submodelId}/operations/{operationId}
				// invoke operationId
			default:
				KS_logfile_info(("ressource is not implemented"));
				ov_string_setvalue(&response->contentType, "text/plain;");
				ov_string_setvalue(&response->contentString, HTTP_404_BODY);
				return OV_ERR_OK;
				break;
		}
	}else if(ov_string_compare(request.requestMethod, "PUT") == OV_STRCMP_EQUAL){
		if(request.urlQuery.veclen == 0){
			KS_logfile_info(("no data in content", request.requestMethod));
			ov_string_setvalue(&response->contentString, "no data\n");
			ov_string_setvalue(&response->contentType, "text/plain;");
			return OV_ERR_BADVALUE;
		}
		switch (pExt->v_queryType){
			case 6:// /aas/submodels/{submodelId}/properties/{propertyId}
				// set value of propertyId
			default:
				KS_logfile_info(("ressource is not implemented"));
				ov_string_setvalue(&response->contentType, "text/plain;");
				ov_string_setvalue(&response->contentString, HTTP_404_BODY);
				return OV_ERR_OK;
				break;
		}

	}else if(ov_string_compare(request.requestMethod, "DELETE") == OV_STRCMP_EQUAL){
		switch (pExt->v_queryType){
			case 2: // /aas/submodels/{submodelId}
				// delete submodelId
			case 6:// /aas/submodels/{submodelId}/properties/{propertyId}
				// delete propertyId
			case 7:// /aas/submodels/{submodelId}/operations/{operationId}
				// delete operationId
			case 8:// /aas/submodels/{submodelId}/events/{eventId}
				// delete eventId
			default:
				KS_logfile_info(("ressource is not implemented"));
				ov_string_setvalue(&response->contentString, HTTP_404_BODY);
				ov_string_setvalue(&response->contentType, "text/plain;");
				return OV_ERR_OK;
				break;
		}
	}else {
		KS_logfile_info(("incompatible requestMethod %s for openaasHTTP Extension", request.requestMethod));
		ov_string_setvalue(&response->contentString, "bad requestMethod for handler\n");
		ov_string_setvalue(&response->contentType, "text/plain;");
		return OV_ERR_BADPARAM;
	}
	response->keepAlive = FALSE;

	return OV_ERR_OK;
}
